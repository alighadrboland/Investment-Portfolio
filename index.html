<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù¾ÙˆØ±ØªÙÙˆÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú¯Ø°Ø§Ø±ÛŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">

  <!-- ğŸª™ Favicon Ú©Ù„Ø§Ø³ÛŒÚ© -->
  <link rel="icon" type="image/x-icon" href="icons/favicon.ico">

  <!-- ğŸ“± Ø¢ÛŒÚ©Ù† Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯ Ùˆ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">

  <!-- ğŸ Ø¢ÛŒÚ©Ù† Ø¨Ø±Ø§ÛŒ iPhone / iPad -->
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <!-- ğŸ§­ Ø±Ù†Ú¯ Ù†ÙˆØ§Ø± Ù…Ø±ÙˆØ±Ú¯Ø± -->
  <meta name="theme-color" content="#250987">

  <!-- ğŸ§­ Ø¬Ù‡Øª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø³Øª Ø¯Ø± iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    * { font-family: 'Vazirmatn', sans-serif !important; }
    .persian-numbers { font-feature-settings: "ss01"; direction: rtl; }
    .fade-update { animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn { 0% { opacity: 0.2; transform: scale(0.97); } 100% { opacity: 1; transform: scale(1); } }
  </style>
</head>
<body class="bg-yellow-400 text-black">
  <main class="max-w-xl mx-auto p-3 space-y-1">
    <section class="bg-purple-800 rounded-xl shadow-2xl p-2 text-center">
       <button id="refresh-btn" class="text-white text-base w-full">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±Ø²Ø´ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ø§</button>
    </section>
    
        <section id="gold-bubble" class="rounded-xl shadow-2xl p-2 text-center text-white persian-numbers">
      Ø­Ø¨Ø§Ø¨ Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±: <span id="goldbubble"></span>
        </section>

    <section class="bg-white rounded-xl shadow-2xl p-3 text-center border-2 border-blue-700">
      <div class="text-lg font-bold space-y-1 persian-numbers drop-shadow-lg">
        <div id="usd-box">Ø¯Ù„Ø§Ø±: ...</div>
        <div id="usdt-box">ØªØªØ±: ...</div>
        <div id="gold18-box">Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±: ...</div>
        <div id="fund-price-box">ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù‡Ø±Ø¨Ø§: ...</div>
        <p id="gold-price" class="hidden"></p>
        <small id="gold-change" class="hidden"></small>
      </div>
    </section>

    <section id="profit-box" class="bg-white rounded-xl shadow-2xl p-3 text-center text-black mt-3 persian-numbers border-2 border-blue-700">
      Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†...
    </section>

    <section id="crypto-box" class="bg-white rounded-xl shadow-2xl p-3 text-center text-black persian-numbers border-2 border-blue-700">
      Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§...
    </section>

    <section class="bg-white rounded-xl shadow-2xl p-3 text-center persian-numbers border-2 border-blue-700">
      <h3 id="portfolio-title" class="text-2xl font-extrabold text-purple-800 mb-2 drop-shadow-lg">Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ²Ø§Ù† Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú¯Ø°Ø§Ø±ÛŒ...</h3>
      <p id="portfolio-value" class="text-xl font-extrabold persian-numbers text-black mt-3 drop-shadow-lg">Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ²Ø§Ù† Ø¯Ø§Ø±Ø§ÛŒÛŒ...</p>
      <p id="merged-value" class="text-xl font-bold persian-numbers text-black mt-2 drop-shadow-lg"></p>
      <p id="profit-percent" class="text-xl font-bold persian-numbers mt-2 drop-shadow-lg"></p>
    </section>

    <section id="final-box" 
         class="bg-white rounded-xl shadow-2xl p-3 text-center text-black mt-3 persian-numbers border-2 border-blue-700 text-xl font-bold drop-shadow-lg">
      Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†
    </section>


    <p id="last-update" class="text-sm text-black text-center drop-shadow-lg mt-4 persian-numbers">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø²Ù…Ø§Ù†...</p>
  </main>

  <script>
  (function AppModule() {
    // Ø«Ø§Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² (Ú©Ù… Ùˆ Ù…ÙÛŒØ¯)
    const kahroba_UNITS = 546;
    const AVG_kahroba_PRICE = 126239;
    const BTC_AMOUNT = 0.00064135;
    const MY_GOLD_GRAMS = 0;
    const INVESTMENT_KAHROBA = 2500000 + 4384000;
    const INVESTMENT_BTC = 2811000 + 3842000;
    const INVESTMENT_BASE = INVESTMENT_KAHROBA + INVESTMENT_BTC;
    const START_DATE = new Date(2025, 10, 25); // 25 Ù†ÙˆØ§Ù…Ø¨Ø± 2025

    // Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§
    function toPersianNumber(input) {
      if (input === null || input === undefined) return '';
      if (typeof input === 'number') input = input.toLocaleString('en-US');
      const persianDigits = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];
      return input.toString().replace(/\d/g, d => persianDigits[d]);
    }

    function animateElement(id, content) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('fade-update');
      void el.offsetWidth;
      el.innerHTML = content;
      el.classList.add('fade-update');
    }

    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ… 'Ú©Ù‡Ø±Ø¨Ø§' Ø¯Ø± Ù¾Ø§Ø³Ø®â€Œâ€ŒÙ‡Ø§ (ÙØ´Ø±Ø¯Ù‡ Ùˆ Ù…Ù‚Ø§ÙˆÙ…)
    function findkahrobaInArray(arr) {
      if (!Array.isArray(arr)) return null;
      return arr.find(item => {
        if (!item) return false;
        const fields = ['l18','fa','name','title','pc','pcc','pcp'];
        for (const f of fields) {
          if (item[f] && typeof item[f] === 'string' && item[f].includes && item[f].includes('Ú©Ù‡Ø±Ø¨Ø§')) return true;
        }
        // fallback: Ù‡Ø± ÙÛŒÙ„Ø¯ Ù…ØªÙ†ÛŒ Ú©Ù‡ Ø´Ø§Ù…Ù„ 'Ú©Ù‡Ø±Ø¨Ø§' Ø¨Ø§Ø´Ø¯
        return Object.values(item).some(v => typeof v === 'string' && v.includes && v.includes('Ú©Ù‡Ø±Ø¨Ø§'));
      }) || null;
    }

    // ØªÙ„Ø§Ø´ ØªØ³Ù„Ø³Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ù„ÛŒØ³Øª Ù†Ù…Ø§Ø¯Ù‡Ø§
    async function fetchkahrobaFromEndpoints(urls) {
      for (const url of urls) {
        try {
          const res = await fetch(url);
          if (!res.ok) continue;
          const json = await res.json();
          let arr = null;
          if (Array.isArray(json)) arr = json;
          else if (json && Array.isArray(json.data)) arr = json.data;
          else if (json && Array.isArray(json.symbols)) arr = json.symbols;
          else {
            arr = Object.values(json).find(v => Array.isArray(v)) || null;
          }
          const found = findkahrobaInArray(arr);
          if (found) return found;
        } catch (e) {
          // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ Ø¨Ø¹Ø¯ÛŒ
        }
      }
      return null;
    }

    // Ø§Ø¬Ø±Ø§: Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ø§Øª
    async function fetchData() {
      // Ø±ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
      animateElement('crypto-box', 'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§...');
      animateElement('profit-box', 'Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÙˆØ¯/Ø²ÛŒØ§Ù†...');
      animateElement('usd-box', 'Ø¯Ù„Ø§Ø±: ...');
      animateElement('usdt-box', 'ØªØªØ±: ...');

      try {
        // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù‡Ù…â€ŒØ²Ù…Ø§Ù† Ù…Ù†Ø§Ø¨Ø¹ (coingecko Ùˆ brsapi)
        const [cgRes, brsRes] = await Promise.all([
          fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,tether&vs_currencies=usd&include_24hr_change=true'),
          fetch('https://brsapi.ir/Api/Market/Gold_Currency.php?key=FreeTZPrEbgTZzbW2SSGXOlzjlulRFcz')
        ]);
        const cg = cgRes.ok ? await cgRes.json() : {};
        const brs = brsRes.ok ? await brsRes.json() : {};

        // Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§
        const bitcoin = cg && cg.bitcoin ? cg.bitcoin : null;
        const tether = cg && cg.tether ? cg.tether : null;
        const totalUsdFromBtc = (bitcoin && BTC_AMOUNT) ? (BTC_AMOUNT * (bitcoin.usd || 0)) : 0;

        // Ù†Ø±Ø® Ø±ÛŒØ§Ù„ÛŒ Ø§Ø² brsapi (USDT_IRT)
        const usdtObj = (brs && brs.currency) ? brs.currency.find(i => i.symbol === 'USDT_IRT') || {} : {};
        const usdtPrice = usdtObj.price || 0;
        const totalIrt = Math.floor(totalUsdFromBtc * usdtPrice);
        const btcpr = Math.floor(totalUsdFromBtc * usdtPrice) || 0;

        // Ù†Ù…Ø§ÛŒØ´ Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§
        if (bitcoin) {
          const btcChange = bitcoin.usd_24h_change || 0;
          const btcm = BTC_AMOUNT * (bitcoin.usd || 0);
          const getColor = c => c > 0 ? 'green' : c < 0 ? 'red' : 'black';
          animateElement('crypto-box', `
            <div class="text-2xl font-extrabold drop-shadow-lg text-purple-800">Ø¨ÛŒØª Ú©ÙˆÛŒÙ† (${toPersianNumber(BTC_AMOUNT.toString())})</div>
            <div class="space-y-1 mt-5 text-lg font-bold drop-shadow-lg">
              <div style="color:${getColor(btcChange)}">
                BTC: $${toPersianNumber((bitcoin.usd||0).toLocaleString())}
                (%${toPersianNumber(Math.abs((btcChange||0).toFixed(2)))})
                = $${toPersianNumber(Math.floor(btcm).toLocaleString())} | ${toPersianNumber(btcpr.toLocaleString())}
              </div>
            </div>
          `);
        } else {
          animateElement('crypto-box', 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†');
        }

        // Ù†Ù…Ø§ÛŒØ´ ØªØªØ±
        const usdtChangeValue = usdtObj.change_value !== undefined ? usdtObj.change_value : 0;
        const usdtChangePercent = usdtObj.change_percent !== undefined ? usdtObj.change_percent : 0;
        const usdtColor = usdtObj.change_percent > 0 ? 'green' : usdtObj.change_percent < 0 ? 'red' : 'black';
        animateElement('usdt-box', `<span style="color:${usdtColor}">ØªØªØ±: ${toPersianNumber(usdtPrice.toLocaleString())} (${toPersianNumber(Math.abs(usdtChangeValue).toLocaleString())} | ${toPersianNumber(Math.abs(usdtChangePercent.toFixed(2)))}%)</span>`);

        // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø·Ù„Ø§ Ùˆ Ø¯Ù„Ø§Ø± Ø§Ø² brsapi
        const goldList = brs && brs.gold ? brs.gold : [];
        const currencyList = brs && brs.currency ? brs.currency : [];
        const gold18 = goldList.find(i => i.symbol === 'IR_GOLD_18K') || null;
        const usd = currencyList.find(i => i.symbol === 'USD') || null;
        const ounceGold = goldList.find(i => i.symbol === 'XAUUSD') || null;

        // Ø­Ø¨Ø§Ø¨ Ø·Ù„Ø§ Ùˆ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø®Ø´ Ø­Ø¨Ø§Ø¨
        if (ounceGold && usd) {
          const gvalue = ((ounceGold.price * usd.price) / 31.1034768) * 0.75;
          const gbubble = gold18 ? ((gold18.price - gvalue) / gvalue) * 100 : 0;
          const goldbubbleElement = document.getElementById('goldbubble');
          const formattedGbubble = toPersianNumber(Math.abs(gbubble).toFixed(2)) + "Ùª" + (gbubble < 0 ? "âˆ’" : "");
          if (goldbubbleElement) goldbubbleElement.innerText = formattedGbubble;

          const goldBubbleBox = document.getElementById('gold-bubble');
          if (goldBubbleBox) {
            goldBubbleBox.classList.remove('bg-green-800','bg-blue-800','bg-red-800');
            if (gbubble < 0) goldBubbleBox.classList.add('bg-green-800');
            else if (gbubble >= 0 && gbubble < 1) goldBubbleBox.classList.add('bg-blue-800');
            else goldBubbleBox.classList.add('bg-red-800');
          }
        }

        // Ø¯Ù„Ø§Ø± Ùˆ Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ
        if (usd) {
          const usdChangeValue = usd.change_value !== undefined ? usd.change_value : 0;
          const usdChangePercent = usd.change_percent !== undefined ? usd.change_percent : 0;
          const color = usdChangeValue > 0 ? 'green' : usdChangeValue < 0 ? 'red' : 'black';
          animateElement('usd-box', `<span style="color:${color}">Ø¯Ù„Ø§Ø±: ${toPersianNumber(Math.floor(usd.price).toLocaleString())} (${toPersianNumber(Math.abs(usdChangeValue).toLocaleString())} | ${toPersianNumber(Math.abs(usdChangePercent.toFixed(2)))}%)</span>`);

          if (ounceGold) {
            const ozChangeValue = ounceGold.change_value !== undefined ? ounceGold.change_value : 0;
            const ozChangePercent = ounceGold.change_percent !== undefined ? ounceGold.change_percent : 0;
            const ozColor = ozChangeValue > 0 ? 'green' : ozChangeValue < 0 ? 'red' : 'black';
            const ounceHtml = `<div id="ounce-box" style="color:${ozColor}">Ø§Ù†Ø³ Ø¬Ù‡Ø§Ù†ÛŒ Ø·Ù„Ø§: ${toPersianNumber(Math.floor(ounceGold.price).toLocaleString())}$ (${toPersianNumber(Math.abs(ozChangeValue).toLocaleString())}$ | ${toPersianNumber(Math.abs(ozChangePercent.toFixed(2)))}%)</div>`;
            const existing = document.getElementById('ounce-box');
            if (existing) existing.outerHTML = ounceHtml;
            else document.getElementById('usdt-box').insertAdjacentHTML('afterend', ounceHtml);
          }
        }

        // Ø·Ù„Ø§ÛŒ 18
        if (gold18) {
          const gChangeValue = gold18.change_value !== undefined ? gold18.change_value : 0;
          const gChangePercent = gold18.change_percent !== undefined ? gold18.change_percent : 0;
          const changeColor = gChangePercent > 0 ? 'green' : gChangePercent < 0 ? 'red' : 'black';
          animateElement('gold18-box', `<span style="color:${changeColor}">Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±: ${toPersianNumber(Math.floor(gold18.price).toLocaleString())} (${toPersianNumber(Math.abs(gChangeValue).toLocaleString())} | ${toPersianNumber(Math.abs(gChangePercent.toFixed(2)))}%)</span>`);

          // Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¯Ø§Ø®Ù„ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø·Ù„Ø§ / ØµÙ†Ø¯ÙˆÙ‚
          const goldPrice = gold18.price;
          const commission = goldPrice - 30000;
          const totalGoldValue = MY_GOLD_GRAMS * commission;

          // Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆØ²Ù‡Ø§ Ø§Ø² ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹
          const today = new Date();
          const diffDays = Math.floor((today - START_DATE) / (1000 * 60 * 60 * 24));
          document.getElementById('portfolio-title').innerText = `Ù…Ø¯Øª Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú¯Ø°Ø§Ø±ÛŒ: ${toPersianNumber(diffDays)} Ø±ÙˆØ²`;
          animateElement('portfolio-value', `Ø§Ø±Ø²Ø´ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú¯Ø°Ø§Ø±ÛŒ: ${toPersianNumber(INVESTMENT_BASE)}`);

          // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØµÙ†Ø¯ÙˆÙ‚ 'Ú©Ù‡Ø±Ø¨Ø§' Ø§Ø² Ú†Ù†Ø¯ endpoint
          const urls = [
            "https://brsapi.ir/Api/Tsetmc/AllSymbols.php?key=FreeTZPrEbgTZzbW2SSGXOlzjlulRFcz&type=1",
            "https://brsapi.ir/Api/Tsetmc/AllSymbols.php?key=FreeKyzGgWec9Po3hG9QVoMxMtCI3z5P&type=1",
            "https://brsapi.ir/Api/Tsetmc/AllSymbols.php?key=FreezhPfvWeEOGOPucTWsPukkDazGzTQ&type=1"
          ];
          const kahroba = await fetchkahrobaFromEndpoints(urls);

          // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù†Ù…Ø§ÛŒØ´ ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù‡Ø±Ø¨Ø§ Ùˆ Ø¨ÛŒØª Ú©ÙˆÛŒÙ†
if (kahroba && typeof kahroba.pc === 'number') {
    const kahrobapc = kahroba.pc;
    const kahrobapr = ((kahrobapc - AVG_kahroba_PRICE) / AVG_kahroba_PRICE) * 100;
    const kahrobamoney = ((kahrobapc - AVG_kahroba_PRICE) * kahroba_UNITS) / 10;
    const unitfee = ((kahroba_UNITS * (kahrobapc / 10)) * 0.12) / 100;
    const result = Math.floor((kahroba_UNITS * (kahrobapc / 10)) - unitfee); // Ø§Ø±Ø²Ø´ Ø±ÛŒØ§Ù„ÛŒ ØµÙ†Ø¯ÙˆÙ‚
    const combined = Math.floor(totalGoldValue + result + totalIrt);

    // Ø±Ù†Ú¯ Ø¨Ø±Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚
    const color = (kahroba.pcp !== undefined) ? (kahroba.pcp > 0 ? 'green' : kahroba.pcp < 0 ? 'red' : 'black') : 'black';
    const pcc = kahroba.pcc !== undefined ? kahroba.pcc : 0;
    const pcp = kahroba.pcp !== undefined ? kahroba.pcp : 0;

    animateElement('fund-price-box', `<span style="color:${color}">ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù‡Ø±Ø¨Ø§: ${toPersianNumber(Math.floor(kahrobapc).toLocaleString())} (${toPersianNumber(Math.abs(pcc).toLocaleString())} | ${toPersianNumber(Math.abs(pcp.toFixed(2)))}%)</span>`);

    // Ø³ÙˆØ¯/Ø²ÛŒØ§Ù† ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù‡Ø±Ø¨Ø§
    const kahrobaProfitPercent = ((result - INVESTMENT_KAHROBA) / INVESTMENT_KAHROBA) * 100;
    const kahrobaProfitColor = kahrobaProfitPercent > 0 ? 'green' : kahrobaProfitPercent < 0 ? 'red' : 'black';
    animateElement('profit-box', `
      <div class="text-2xl font-extrabold drop-shadow-lg text-purple-800">ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù‡Ø±Ø¨Ø§ (${toPersianNumber(kahroba_UNITS.toLocaleString())} ÙˆØ§Ø­Ø¯)</div>
      <div class="text-2xl font-extrabold drop-shadow-lg text-black mt-2">${toPersianNumber(result)}</div>
      <div class="text-xl font-bold drop-shadow-lg" style="color:${kahrobaProfitColor}">Ø¨Ø§Ø²Ø¯Ù‡ÛŒ: (${toPersianNumber(Math.abs(kahrobaProfitPercent).toFixed(2))}%)</div>

    `);

    // Ø³ÙˆØ¯/Ø²ÛŒØ§Ù† Ø¨ÛŒØª Ú©ÙˆÛŒÙ†
    const btcValue = Math.floor(btcpr) || 0;
    const btcProfitPercent = ((btcValue - INVESTMENT_BTC) / INVESTMENT_BTC) * 100;
    const btcProfitColor = btcProfitPercent > 0 ? 'green' : btcProfitPercent < 0 ? 'red' : 'black';

    const btcBox = document.getElementById('crypto-box');
    if (btcBox) {
      btcBox.innerHTML += `
        <div class="text-xl font-bold drop-shadow-lg" style="color:${btcProfitColor}">Ø¨Ø§Ø²Ø¯Ù‡ÛŒ: (${toPersianNumber(Math.abs(btcProfitPercent).toFixed(2))}%)</div>
      `;
    }

    // merged, profit percent Ù†Ù‡Ø§ÛŒÛŒ
    const merged = btcValue + result;
    const mergedEl = document.getElementById('merged-value');
    if (mergedEl) mergedEl.innerText = `Ø§Ø±Ø²Ø´ Ø¯Ø§Ø±Ø§ÛŒÛŒ: ${toPersianNumber(merged)}`;

    const profitAmount = merged - INVESTMENT_BASE;
    const profitPercent = INVESTMENT_BASE ? ((profitAmount) / INVESTMENT_BASE) * 100 : 0;

    const profitEl = document.getElementById('final-box');
    const profitColor = profitPercent > 0 ? 'green' : profitPercent < 0 ? 'red' : 'black';
    if (profitEl) {
       profitEl.style.color = profitColor;
       profitEl.innerText = `Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ú©Ù„: ${toPersianNumber(Math.abs(profitAmount))} (${toPersianNumber(Math.abs(profitPercent).toFixed(2))}%)`;
      const days = (typeof diffDays === 'number' && diffDays > 0) ? diffDays : 1;
       const dailyPercent = profitPercent / days;
       const monthlyPercent = dailyPercent * 30;

       // Ù†Ù…Ø§ÛŒØ´: Ù…Ù‚Ø¯Ø§Ø± Ú©Ù„ Ùˆ Ø¯Ø±ØµØ¯ Ú©Ù„ Ùˆ Ø¯Ø± Ø®Ø· Ø¯ÙˆÙ… Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ (Ú†Ù‡Ø§Ø± Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±)
       profitEl.innerHTML = 
    `Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ú©Ù„: ${toPersianNumber(Math.abs(profitAmount))} (${toPersianNumber(Math.abs(profitPercent).toFixed(2))}%)` +         
    `<div style="font-size:0.75em; margin-top:5px;">
        ADR: %${toPersianNumber(Math.abs(dailyPercent).toFixed(2))}  
         -  AMR: %${toPersianNumber(Math.abs(monthlyPercent).toFixed(2))}
    </div>`;
    }
}


          // Ø²Ù…Ø§Ù† Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
          const now = new Date();
          const formattedDate = toPersianNumber(now.toLocaleDateString('fa-IR'));
          const formattedTime = toPersianNumber(now.toLocaleTimeString('fa-IR').replace(/:\d+$/, ''));
          document.getElementById('last-update').innerText = `Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${formattedDate} - ${formattedTime}`;
        }

      } catch (err) {
        // Ø®Ø·Ø§ÛŒ Ú©Ù„ÛŒ
        animateElement('crypto-box', 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§');
        animateElement('profit-box', 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
      }
    }

    // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡ Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    document.getElementById('refresh-btn').addEventListener('click', fetchData);
    fetchData();

    // Ø§Ù†ØªØ´Ø§Ø± (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ø®Ø§Ø±Ø¬)
    window.appFetchData = fetchData;
  })();
  </script>
</body>
</html>
